<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thời Trang Nam - HOA SAC Menswear</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="footer.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Noise Texture -->
    <div class="noise-overlay"></div>

    <div class="preloader">
        <div class="preloader-content">
            <h1 class="brand-name">HOA SAC</h1>
            <div class="loading-line"></div>
        </div>
    </div>

    <div class="custom-cursor"></div>

    <!-- HEADER (SYNCED) -->
    <header class="site-header">
        <div class="header-container">
            <a href="index.html" class="logo">HOA SAC.</a>

            <div class="hamburger-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>

            <nav class="main-nav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="men.html" class="nav-link">Nam</a></li>
                    <li class="nav-item"><a href="women.html" class="nav-link">Nữ</a></li>
                    <li class="nav-item"><a href="collections.html" class="nav-link">Bộ Sưu Tập</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">Stories</a></li>
                    <li class="nav-item"><a href="contact.html" class="nav-link">Liên Hệ</a></li>
                    <li class="nav-item"><a href="about.html" class="nav-link">Về Hoa Sắc</a></li>
                </ul>
            </nav>

            <div class="header-actions">
                <a href="/cart" class="cart-btn">Giỏ hàng (0)</a>
            </div>
        </div>
    </header>

    <main class="products-page">
        
        <!-- HERO HEADER -->
        <section class="product-hero">
            <h1 class="hero-title">The Modern<br><i>Gentleman</i></h1>
            <div class="filter-bar">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="suits">Suits</button>
                <button class="filter-btn" data-filter="shirts">Shirts</button>
                <button class="filter-btn" data-filter="outerwear">Outerwear</button>
                <button class="filter-btn" data-filter="bottoms">Trousers</button>
            </div>
        </section>

        <!-- PRODUCT GRID -->
        <section class="catalog-container">
            <div class="catalog-grid" id="product-grid">
                <!-- Products will be generated by JS below -->
            </div>
        </section>

        <script>
            // HÀM TẢI SẢN PHẨM TỪ HỆ THỐNG
            async function loadProducts() {
                try {
                    const products = await window.getProductsDB();
                    
                    const grid = document.getElementById('product-grid');
                    grid.innerHTML = ''; 

                    // LỌC SẢN PHẨM NAM
                    const menProducts = products.filter(p => p.department === 'men');

                    if(menProducts.length === 0) {
                        grid.innerHTML = '<p style="text-align:center;width:100%;">Đang cập nhật bộ sưu tập mới.</p>';
                        return;
                    }

                    menProducts.forEach(product => {
                        const item = document.createElement('div');
                        item.className = 'product-item';
                        item.setAttribute('data-category', product.category);
                        
                        const formattedPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(product.price);

                        // Xử lý Video (Nếu có)
                        let videoHTML = '';
                        if(product.hover_video) {
                            videoHTML = `<video muted loop playsinline preload="none" class="hover-video">
                                            <source src="assets/videos/${product.hover_video}" type="video/mp4">
                                         </video>`;
                        }

                        // Lưu ý: Ảnh lấy từ folder /men/
                        item.innerHTML = `
                            <div class="prod-img">
                                <a href="product-detail.html?id=${product.id}" style="display:block; width:100%; height:100%;">
                                    <img src="assets/images/products/men/${product.image}" alt="${product.name}" loading="lazy" onerror="this.src='assets/images/products/women/coat.jpg'"> 
                                    ${videoHTML}
                                </a>
                                <span class="quick-add" 
                                    data-name="${product.name}" 
                                    data-price="${formattedPrice}" 
                                    data-img="assets/images/products/men/${product.image}" 
                                    data-cat="${product.category}">+</span>
                            </div>
                            <div class="prod-info">
                                <a href="product-detail.html?id=${product.id}" style="text-decoration:none; color:inherit;">
                                    <h3>${product.name}</h3>
                                </a>
                                <span class="price">${formattedPrice}</span>
                            </div>
                        `;
                        grid.appendChild(item);

                        // Gắn sự kiện Hover Video
                        if(product.hover_video) {
                            const video = item.querySelector('video');
                            item.addEventListener('mouseenter', () => { video.play(); });
                            item.addEventListener('mouseleave', () => { video.pause(); video.currentTime = 0; });
                        }
                    });

                    initFilter();
                    initQuickView();

                } catch (error) {
                    console.error('Lỗi tải sản phẩm:', error);
                }
            }

            // HÀM QUICK VIEW MODAL
            function initQuickView() {
                const quickBtns = document.querySelectorAll('.quick-add');
                const modal = document.getElementById('quick-view-modal');
                const closeBtn = document.querySelector('.close-product-modal');
                
                const mImg = document.getElementById('modal-img-src');
                const mTitle = document.getElementById('modal-title');
                const mPrice = document.getElementById('modal-price');
                const mCat = document.getElementById('modal-cat');

                quickBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        
                        const name = btn.getAttribute('data-name');
                        const price = btn.getAttribute('data-price');
                        const img = btn.getAttribute('data-img');
                        const cat = btn.getAttribute('data-cat');

                        mTitle.innerText = name;
                        mPrice.innerText = price;
                        mImg.src = img;
                        mImg.onerror = function() { this.src = 'assets/images/products/women/coat.jpg'; }; // Fallback ảnh
                        mCat.innerText = cat;

                        modal.classList.add('active');
                    });
                });

                const addCartBtn = modal.querySelector('.btn-add-cart');
                addCartBtn.onclick = () => {
                    const priceString = mPrice.innerText;
                    const priceNum = parseFloat(priceString.replace(/[^0-9.-]+/g,""));
                    const activeSizeBtn = modal.querySelector('.size-btn.active');
                    const size = activeSizeBtn ? activeSizeBtn.innerText : 'L'; // Mặc định L cho nam

                    const product = {
                        name: mTitle.innerText,
                        price: priceNum,
                        image: mImg.src,
                        size: size
                    };

                    window.addToCart(product);
                    modal.classList.remove('active');
                };

                const sizeBtns = modal.querySelectorAll('.size-btn');
                sizeBtns.forEach(sBtn => {
                    sBtn.addEventListener('click', () => {
                        sizeBtns.forEach(b => b.classList.remove('active'));
                        sBtn.classList.add('active');
                    });
                });

                closeBtn.addEventListener('click', () => modal.classList.remove('active'));
                window.addEventListener('click', (e) => { if (e.target == modal) modal.classList.remove('active'); });
            }

            // HÀM BỘ LỌC
            function initFilter() {
                const filterBtns = document.querySelectorAll('.filter-btn');
                const productItems = document.querySelectorAll('.product-item');

                filterBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        filterBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        const filterValue = btn.getAttribute('data-filter');

                        productItems.forEach(item => {
                            const category = item.getAttribute('data-category');
                            if (filterValue === 'all' || filterValue === category) {
                                item.style.display = 'block';
                                item.offsetHeight; 
                                item.style.animation = 'fadeIn 0.5s ease forwards';
                            } else {
                                item.style.display = 'none';
                            }
                        });
                    });
                });
            }

            document.addEventListener('DOMContentLoaded', loadProducts);
        </script>
    </main>

    <!-- FOOTER (SYNCED) -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-col brand-col">
                <h3 class="footer-logo">HOA SAC.</h3>
                <p class="brand-desc">Định hình phong cách cho tương lai.</p>
                <div class="social-links"><a href="#">IG</a><a href="#">FB</a></div>
            </div>
            <div class="footer-col">
                <h4>Khám Phá</h4>
                <ul>
                    <li><a href="/products/new-arrivals">Hàng Mới Về</a></li>
                    <li><a href="collections.html">Bộ Sưu Tập</a></li>
                </ul>
            </div>
            <div class="footer-col newsletter-col">
                <h4>Bản Tin</h4>
                <form class="newsletter-form">
                    <input type="email" placeholder="Email..." required>
                    <button type="submit">→</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <span id="year"></span> HOA SAC Fashion. All rights reserved.</p>
        </div>
    </footer> 

    <!-- QUICK VIEW MODAL -->
    <div class="product-modal-overlay" id="quick-view-modal">
        <div class="product-modal-content">
            <span class="close-product-modal">&times;</span>
            <div class="modal-body">
                <div class="modal-img">
                    <img src="" alt="Product Image" id="modal-img-src">
                </div>
                <div class="modal-details">
                    <span class="modal-category" id="modal-cat">Category</span>
                    <h2 id="modal-title">Product Name</h2>
                    <span class="modal-price" id="modal-price">$0.00</span>
                    <p class="modal-desc">Thiết kế may đo cao cấp (Tailoring) sử dụng chất liệu nhập khẩu Ý. Form dáng chuẩn mực tôn vinh vẻ lịch lãm.</p>
                    
                    <div class="modal-sizes">
                        <span>Size:</span>
                        <button class="size-btn">48</button>
                        <button class="size-btn active">50</button>
                        <button class="size-btn">52</button>
                        <button class="size-btn">54</button>
                    </div>

                    <button class="btn-add-cart">Thêm Vào Giỏ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    <script src="main.js"></script>
</body>
</html>