<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thời Trang Nữ - HOA SAC Collection</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="footer.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Noise Texture -->
    <div class="noise-overlay"></div>

    <div class="preloader">
        <div class="preloader-content">
            <h1 class="brand-name">HOA SAC</h1>
            <div class="loading-line"></div>
        </div>
    </div>

    <div class="custom-cursor"></div>

    <!-- HEADER (SYNCED) -->
    <header class="site-header">
        <div class="header-container">
            <a href="index.html" class="logo">HOA SAC.</a>

            <div class="hamburger-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>

            <nav class="main-nav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="men.html" class="nav-link">Nam</a></li>
                    <li class="nav-item"><a href="women.html" class="nav-link">Nữ</a></li>
                    <li class="nav-item"><a href="collections.html" class="nav-link">Bộ Sưu Tập</a></li>
                    <li class="nav-item"><a href="stories.html" class="nav-link">Stories</a></li>
                    <li class="nav-item"><a href="contact.html" class="nav-link">Liên Hệ</a></li>
                    <li class="nav-item"><a href="about.html" class="nav-link">Về Hoa Sắc</a></li>
                </ul>
            </nav>

            <div class="header-actions">
                <a href="/cart" class="cart-btn">Giỏ hàng (0)</a>
            </div>
        </div>
    </header>

    <main class="products-page">
        
        <!-- HERO HEADER -->
        <section class="product-hero">
            <h1 class="hero-title">The Modern<br><i>Femininity</i></h1>
            <div class="filter-bar">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="outerwear">Outerwear</button>
                <button class="filter-btn" data-filter="dresses">Dresses</button>
                <button class="filter-btn" data-filter="tops">Tops</button>
                <button class="filter-btn" data-filter="bottoms">Bottoms</button>
            </div>
        </section>

        <!-- PRODUCT GRID -->
        <section class="catalog-container">
            <div class="catalog-grid" id="product-grid">
                <!-- Products will be generated by JS below -->
            </div>
        </section>

        <script>
            // HÀM TẢI SẢN PHẨM TỪ HỆ THỐNG (ADMIN COMPATIBLE)
            async function loadProducts() {
                try {
                    // Sử dụng hàm global từ main.js để lấy dữ liệu mới nhất
                    const products = await window.getProductsDB();
                    
                    const grid = document.getElementById('product-grid');
                    grid.innerHTML = ''; // Xóa nội dung cũ (nếu có)

                    // Chỉ lấy sản phẩm Nữ
                    const womenProducts = products.filter(p => p.department === 'women');

                    womenProducts.forEach(product => {
                        const item = document.createElement('div');
                        item.className = 'product-item';
                        item.setAttribute('data-category', product.category);
                        
                        // Format tiền tệ
                        const formattedPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(product.price);

                        // Xử lý Video (Nếu có)
                        let videoHTML = '';
                        if(product.hover_video) {
                            // Dùng video từ assets/videos/ (giả lập)
                            videoHTML = `<video muted loop playsinline preload="none" class="hover-video">
                                            <source src="assets/videos/${product.hover_video}" type="video/mp4">
                                         </video>`;
                        }

                        item.innerHTML = `
                            <div class="prod-img">
                                <a href="product-detail.html?id=${product.id}" style="display:block; width:100%; height:100%;">
                                    <img src="assets/images/products/women/${product.image}" alt="${product.name}" loading="lazy">
                                    ${videoHTML}
                                </a>
                                <span class="quick-add" 
                                    data-name="${product.name}" 
                                    data-price="${formattedPrice}" 
                                    data-img="assets/images/products/women/${product.image}" 
                                    data-cat="${product.category}">+</span>
                            </div>
                            <div class="prod-info">
                                <a href="product-detail.html?id=${product.id}" style="text-decoration:none; color:inherit;">
                                    <h3>${product.name}</h3>
                                </a>
                                <span class="price">${formattedPrice}</span>
                            </div>
                        `;
                        grid.appendChild(item);

                        // Gắn sự kiện Hover Video
                        if(product.hover_video) {
                            const video = item.querySelector('video');
                            item.addEventListener('mouseenter', () => { video.play(); });
                            item.addEventListener('mouseleave', () => { video.pause(); video.currentTime = 0; });
                        }
                    });

                    // Khởi động lại bộ lọc sau khi có dữ liệu
                    initFilter();
                    // Khởi động Quick View
                    initQuickView();

                } catch (error) {
                    console.error('Lỗi tải sản phẩm:', error);
                    document.getElementById('product-grid').innerHTML = '<p style="text-align:center; width:100%;">Đang cập nhật sản phẩm...</p>';
                }
            }

            // HÀM QUICK VIEW MODAL
            function initQuickView() {
                const quickBtns = document.querySelectorAll('.quick-add');
                const modal = document.getElementById('quick-view-modal');
                const closeBtn = document.querySelector('.close-product-modal');
                
                // Elements trong modal
                const mImg = document.getElementById('modal-img-src');
                const mTitle = document.getElementById('modal-title');
                const mPrice = document.getElementById('modal-price');
                const mCat = document.getElementById('modal-cat');

                quickBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation(); // Không kích hoạt click vào sản phẩm cha
                        
                        // Lấy dữ liệu
                        const name = btn.getAttribute('data-name');
                        const price = btn.getAttribute('data-price');
                        const img = btn.getAttribute('data-img');
                        const cat = btn.getAttribute('data-cat');

                        // Điền dữ liệu
                        mTitle.innerText = name;
                        mPrice.innerText = price;
                        mImg.src = img;
                        mCat.innerText = cat;

                        // Hiện Modal
                        modal.classList.add('active');
                    });
                });

                // Xử lý nút thêm vào giỏ trong Modal
                const addCartBtn = modal.querySelector('.btn-add-cart');
                addCartBtn.onclick = () => {
                    const priceString = mPrice.innerText; // "$1,200"
                    const priceNum = parseFloat(priceString.replace(/[^0-9.-]+/g,"")); // 1200

                    // Lấy size đang chọn
                    const activeSizeBtn = modal.querySelector('.size-btn.active');
                    const size = activeSizeBtn ? activeSizeBtn.innerText : 'M';

                    const product = {
                        name: mTitle.innerText,
                        price: priceNum,
                        image: mImg.src,
                        size: size
                    };

                    window.addToCart(product);
                    modal.classList.remove('active'); // Đóng modal sau khi thêm
                };

                // Chọn Size
                const sizeBtns = modal.querySelectorAll('.size-btn');
                sizeBtns.forEach(sBtn => {
                    sBtn.addEventListener('click', () => {
                        sizeBtns.forEach(b => b.classList.remove('active'));
                        sBtn.classList.add('active');
                    });
                });

                // Đóng modal
                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('active');
                });

                window.addEventListener('click', (e) => {
                    if (e.target == modal) {
                        modal.classList.remove('active');
                    }
                });
            }

            // HÀM BỘ LỌC (Tách ra để tái sử dụng)
            function initFilter() {
                const filterBtns = document.querySelectorAll('.filter-btn');
                const productItems = document.querySelectorAll('.product-item');

                filterBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        // 1. Active state
                        filterBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        const filterValue = btn.getAttribute('data-filter');

                        // 2. Filter Logic
                        productItems.forEach(item => {
                            const category = item.getAttribute('data-category');
                            if (filterValue === 'all' || filterValue === category) {
                                item.style.display = 'block';
                                item.style.animation = 'none'; // Reset animation
                                item.offsetHeight; /* trigger reflow */
                                item.style.animation = 'fadeIn 0.5s ease forwards';
                            } else {
                                item.style.display = 'none';
                            }
                        });
                    });
                });
            }

            // Chạy hàm tải sản phẩm khi trang web load xong
            document.addEventListener('DOMContentLoaded', loadProducts);
        </script>
    </main>

    <!-- FOOTER (SYNCED) -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-col brand-col">
                <h3 class="footer-logo">HOA SAC.</h3>
                <p class="brand-desc">Định hình phong cách cho tương lai.</p>
                <div class="social-links">
                    <a href="#">IG</a><a href="#">FB</a>
                </div>
            </div>
            <div class="footer-col">
                <h4>Khám Phá</h4>
                <ul>
                    <li><a href="/products/new-arrivals">Hàng Mới Về</a></li>
                    <li><a href="collections.html">Bộ Sưu Tập</a></li>
                </ul>
            </div>
            <div class="footer-col newsletter-col">
                <h4>Bản Tin</h4>
                <form class="newsletter-form">
                    <input type="email" placeholder="Email..." required>
                    <button type="submit">→</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <span id="year"></span> HOA SAC Fashion. All rights reserved.</p>
        </div>
    </footer> 

    <!-- QUICK VIEW MODAL -->
    <div class="product-modal-overlay" id="quick-view-modal">
        <div class="product-modal-content">
            <span class="close-product-modal">&times;</span>
            <div class="modal-body">
                <div class="modal-img">
                    <img src="" alt="Product Image" id="modal-img-src">
                </div>
                <div class="modal-details">
                    <span class="modal-category" id="modal-cat">Category</span>
                    <h2 id="modal-title">Product Name</h2>
                    <span class="modal-price" id="modal-price">$0.00</span>
                    <p class="modal-desc">Sản phẩm được chế tác thủ công từ chất liệu cao cấp nhất. Thiết kế tinh giản tôn vinh vẻ đẹp tự nhiên.</p>
                    
                    <div class="modal-sizes">
                        <span>Size:</span>
                        <button class="size-btn">S</button>
                        <button class="size-btn active">M</button>
                        <button class="size-btn">L</button>
                    </div>

                    <button class="btn-add-cart">Thêm Vào Giỏ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    <script src="main.js"></script>
</body>
</html>